# Konstruktor

**Konstruktor** ‚Äî —ç—Ç–æ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—Ö–µ–º, –≤–æ—Ä–æ–Ω–æ–∫ –∏ –∫–∞–Ω–±–∞–Ω-–¥–æ—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤.  

---

## ‚ö° –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

1. **–û–Ω—Ç–æ–ª–æ–≥–∏–∏**
   - –§–æ—Ä–º–∞—Ç—ã —Ñ–æ—Ä–º—É–ª: `*C1(+C1.1*C1.2)~C2`
     - `*` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
     - `+` ‚Äî –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
     - `()` ‚Äî –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
     - `~` ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç/–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
     - –ó–∞–≥–æ–ª–æ–≤–æ–∫, —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏ –æ–±–≤–æ–¥–∫–∏, –∏–∫–æ–Ω–∫–∞
     - –ê–≤—Ç–æ—Ä–∞–∑–º–µ—Ä, —à–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞, —Å–∫—Ä—ã—Ç–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
   - –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å: –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª—ã ‚Üî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
   - –ò–º–ø–æ—Ä—Ç –±–ª–æ–∫–æ–≤ –∏ —Å—Ö–µ–º –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º –±–µ–∑ —Ñ–æ—Ä–º—É–ª**
   - –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫-—Å—Ö–µ–º
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–ª–æ–∫–æ–≤, —Ä–∞–∑–º–µ—Ä–æ–≤, —Ü–≤–µ—Ç–æ–≤

3. **–®–∞–±–ª–æ–Ω—ã —Å—Ö–µ–º**
   - –° —Ñ–æ—Ä–º—É–ª–∞–º–∏ –∏ –±–µ–∑ —Ñ–æ—Ä–º—É–ª
   - –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
   - –í—Å—Ç–∞–≤–∫–∞ –±–ª–æ–∫–æ–≤ –∏–ª–∏ —Ü–µ–ª—ã—Ö —Å—Ö–µ–º –≤ –æ–±—ã—á–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

4. **–í–æ—Ä–æ–Ω–∫–∏**
   - –°–ª–æ–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–ª–æ–µ–≤
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

5. **–ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∞**
   - –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è –∏ –±–ª–æ–∫–æ–≤
   - –ü–æ–¥–æ–±–Ω–∞ –¥–æ—Å–∫–µ Bitrix24

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–§—Ä–æ–Ω—Ç–µ–Ω–¥:** React 19, Next.js 15, MUI 7, Emotion, XYFlow
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:** DnD-kit, use-debounce
- **–ë—ç–∫–µ–Ω–¥:** Next.js API routes
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** MySQL —á–µ—Ä–µ–∑ Prisma ORM
- **–ü—Ä–æ—á–µ–µ:** zod (–≤–∞–ª–∏–¥–∞—Ü–∏—è), lz-string (—Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö), jsPDF, dom-to-image/html-to-image
- **CI/CD:** GitHub Actions, Docker, Docker Compose

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- app/ # –°—Ç—Ä–∞–Ω–∏—Ü—ã Next.js
- components/ # UI –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã (Diagram, Funnel, Kanban)
- hooks/ # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏
- Icons/ # –ù–∞–±–æ—Ä –∏–∫–æ–Ω–æ–∫ –¥–ª—è –±–ª–æ–∫–æ–≤
- utils/ # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ñ–æ—Ä–º—É–ª—ã, —ç–∫—Å–ø–æ—Ä—Ç)
- prisma/ # Prisma —Å—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- styles/ # MUI —Ç–µ–º–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- public/ # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã (–∏–∫–æ–Ω–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma)
- **Diagram** ‚Äî —Å—Ö–µ–º—ã
- **Ontology** ‚Äî –æ–Ω—Ç–æ–ª–æ–≥–∏–∏
- **Funnel** ‚Äî –≤–æ—Ä–æ–Ω–∫–∏
- **Kanban** ‚Äî –∫–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∏
- **TemplateDiagram / TemplateOntology** ‚Äî —à–∞–±–ª–æ–Ω—ã —Å—Ö–µ–º
- **User** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏ (user/admin)

> –í—Å–µ –≥—Ä–∞—Ñ—ã (nodes –∏ edges) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–∂–∞—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

---

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ù–∏–∂–µ –æ–ø–∏—Å–∞–Ω **–ü–†–ò–ú–ï–†–ù–´–ô** –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ **Konstruktor** –∫–∞–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ, —Ç–∞–∫ –∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–µ —Å Docker –∏ Docker Compose.


### 1Ô∏è‚É£ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone <repo_url>
cd konstruktor
````

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
```

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π–ª `.env`:

```env
NEXTAUTH_SECRET=YOUR_SECRET
SECRET=YOUR_SECRET
NEXT_PUBLIC_BASE_URL=http://localhost:8080
NEXTAUTH_URL=http://localhost:8080
DATABASE_URL="mysql://USER:PASSWORD@HOST:PORT/DATABASE"
```

4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma –∫–ª–∏–µ–Ω—Ç –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
npx prisma generate
npx prisma migrate dev
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
npm run dev
```

6. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–±–æ—Ä–∫–∏:

```bash
npm run build
npm start
```

> –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8080`.

---

### 2Ô∏è‚É£ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Docker

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ Docker Compose:

```bash
sudo apt update
sudo apt install -y docker.io docker-compose
sudo systemctl enable docker
sudo systemctl start docker
```

2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CI/CD —á–µ—Ä–µ–∑ GitHub Actions).

---

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env` –Ω–∞ –ø—Ä–æ–¥–µ

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `/var/www/konstruktor__usr/data/.env` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```env
NEXTAUTH_SECRET=ZXCCONSSEC2025
SECRET=ZXCCONSSEC2025
NEXT_PUBLIC_BASE_URL=http://185.125.90.92:8080
NEXTAUTH_URL=http://185.125.90.92:8080
DATABASE_URL=mysql://konstruktor_:5yeWcbNiqg3snYd3@127.0.0.1:3306/konstruktor_
```

> –í–∞–∂–Ω–æ: **–Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω–æ**, —Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `docker-compose.yml`

```yaml
services:
  konstruktor-app:
    build: .
    image: konstruktor:latest
    network_mode: host
    restart: always
    env_file:
      - .env
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**

* `network_mode: host` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ MySQL –Ω–∞ `127.0.0.1`.
* `restart: always` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ–µ.
* `env_file: .env` –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

### 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –Ω–∞ –ø—Ä–æ–¥–µ

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cd /var/www/konstruktor__usr/data/
```

2. –ü–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker compose up -d --build
```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

```bash
docker run --rm --network host --env-file .env konstruktor:latest npx prisma migrate deploy
```

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker ps
```

> –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://185.125.90.92:8080`.

---

### 4Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-–≤–µ—Ä—Å–∏–∏

1. –°–æ–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π Docker-–æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ CI/CD:

```bash
docker build -t konstruktor:latest .
```

2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ —á–µ—Ä–µ–∑ GitHub Actions).

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker compose down
docker compose up -d --force-recreate
```

4. –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã (–ø–æ –∂–µ–ª–∞–Ω–∏—é):

```bash
docker image prune -af
```

---

### 5Ô∏è‚É£ –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

* –í—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω–∏—Ç–µ `.env` –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º –º–µ—Å—Ç–µ, –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
* –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ MySQL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–Ω–∞.
* –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Prisma –º–æ–¥–µ–ª–µ–π –≤—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–π—Ç–µ `npx prisma generate`, –∑–∞—Ç–µ–º `npx prisma migrate dev` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `npx prisma migrate deploy` (–Ω–∞ –ø—Ä–æ–¥–µ).
* –î–ª—è –±—ç–∫–∞–ø–∞ MySQL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `mysqldump` –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ö–æ—Å—Ç–∏–Ω–≥–∞.

---